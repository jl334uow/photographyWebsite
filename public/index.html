<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8"/>
  <meta name = "viewport" content = "width = device-width, initial-scale = 1.0">
  <title>JUSTINLUPHOTOGRAPHY</title>
  <link href="https://fonts.googleapis.com/css?family=Alata&display=swap" rel="stylesheet">
  <link rel = "stylesheet" href = "style.css">
  <link href="/css/lightbox.min.css" rel="stylesheet" />
</head>
<body>
  <div class = "container">
    <!-- Nav wrapper -->
    <div id="nav"></div>
    <script>
      fetch("/nav.html")
        .then(res => res.text())
        .then(html => {
          document.getElementById("nav").innerHTML = html;
        });
    </script>

    <!-- Content wrapper -->
    <div class = "content-wrapper">
      <div class = "portfolio-items-wrapper" id = "portfolio-items-wrapper">
        <div class = "portfolio-item-wrapper">
          <div class = "portfolio-img-background" style = "background-image:url(compressed/IMG_1658.jpg)"></div>
          <div class = "img-text-wrapper">
            <a class = "subtitle" href="event.html">
              Events
            </a>
          </div>
        </div>

        <div class = "portfolio-item-wrapper">
          <div class = "portfolio-img-background" style = "background-image:url(compressed/IMG_1661.jpg)"></div>
          <div class = "img-text-wrapper">
            <a class = "subtitle" href="portrait.html">
              Portraits
            </a>
          </div>
        </div>

        <div class = "portfolio-item-wrapper">
          <div class = "portfolio-img-background" style = "background-image:url(compressed/IMG_1721.jpg)"></div>
          <div class = "img-text-wrapper">
            <div class = "subtitle">
              Editorial
            </div>
          </div>
        </div>

        <div class = "portfolio-item-wrapper">
          <div class = "portfolio-img-background" style = "background-image:url(compressed/IMG_1746.jpg)"></div>
          <div class = "img-text-wrapper">
            <a class = "subtitle" href="travel.html">
              Travel
            </a>
          </div>
        </div>

        <div class = "portfolio-item-wrapper">
          <div class = "portfolio-img-background" style = "background-image:url(compressed/IMG_1797.jpg)"></div>
          <div class = "img-text-wrapper">
            <a class = "subtitle" href="about.html">
              About
            </a>
          </div>
        </div>

        <div class = "portfolio-item-wrapper">
          <div class = "portfolio-img-background" style = "background-image:url(compressed/IMG_1809.jpg)"></div>
          <div class = "img-text-wrapper">
            <a class = "subtitle" href="contact.html">
              Contact
            </a>
          </div>
        </div>
      </div>
      <div id = "loading" style="display: none;">
        Loading...
      </div>
    </div>

  </div> <!--container-->
  <script src="/js/lightbox-plus-jquery.min.js"></script>
</body>
<!-- Script to control menu button -->
<script>
  const hamburger = document.getElementById("menu");
  const navLinks = document.getElementById("nav-links");

  hamburger.addEventListener("click", () => {
    navLinks.classList.toggle("show");
  });
</script>

<script>
  const portfolioItems = document.querySelectorAll('.portfolio-item-wrapper')

  portfolioItems.forEach(
    portfolioItem =>{
      portfolioItem.addEventListener('mouseover', () => {
        portfolioItem.childNodes[1].classList.add('img-darken');
      })

      portfolioItem.addEventListener('mouseout', () => {
        portfolioItem.childNodes[1].classList.remove('img-darken');
      })
    }

  )
</script>

<script type="module" defer>
  const imagePaths = [
    "compressed/IMG_1658.jpg",
    "compressed/IMG_1661.jpg",
    "compressed/IMG_1721.jpg",
    "compressed/IMG_1746.jpg",
    "compressed/IMG_1809.jpg",
    "compressed/IMG_1833.jpg",
    "compressed/IMG_1841.jpg",
    "compressed/IMG_1851.jpg",
    "compressed/IMG_1878.jpg",
    "compressed/IMG_1954.jpg",
    "compressed/IMG_1964.jpg",
    "compressed/IMG_1969.jpg",
    "compressed/IMG_1971.jpg",
    "compressed/IMG_1996.jpg"
  ]

  let photosPerLoad = 3;
  let curIndex = 0;
  let loading = false;

  async function loadMorePhotos() {
    if(loading) return; /* stop function if loading is already in progress */

    loading = true;

    document.getElementById('loading').style.display = 'block';

    const gallery = document.getElementById('portfolio-items-wrapper');
    const end = Math.min(curIndex + photosPerLoad, imagePaths.length);
    // frontend script
    const response = await fetch('/api/photographyWebsite');
    const data = await response.json();
    const urls = Array.from(data.values());
    for(let i = curIndex; i < end; i++) {
      const divItemWrapper = document.createElement('div');
      divItemWrapper.className = 'portfolio-item-wrapper';

      const lightboxLink = document.createElement('a');
      lightboxLink.className = 'lightbox-link';
      lightboxLink.href = `${urls[i]['url']}`;
      lightboxLink.setAttribute('data-lightbox', 'gallery');

      const divImgBackground = document.createElement('img');
      divImgBackground.className = 'portfolio-img-background';
      divImgBackground.src = `${urls[i]['url']}`;
      // console.log(`url(${data[i]})`);

      divItemWrapper.appendChild(lightboxLink);
      lightboxLink.appendChild(divImgBackground);
      gallery.appendChild(divItemWrapper)
      lightbox.init();
    }

    curIndex = end;

    document.getElementById('loading').style.display = 'none';
    loading = false;
  }

  function handleScroll() {
    if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
      loadMorePhotos();
    }
  }

  loadMorePhotos();
  window.addEventListener('scroll', handleScroll);

</script>
</html>
